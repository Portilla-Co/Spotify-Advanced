<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="style.css">
</head>


<body>
    <audio class="song" src="./song.mp3"></audio>
    <div class="mainContainer">
        <div class="header">
            <button>
                <svg role="img" height="24" width="24" class="Svg-sc-1bi12j5-0 jgfuCe IYDlXmBmmUKHveMzIPCF"
                    viewBox="0 0 24 24">
                    <path
                        d="M15.957 2.793a1 1 0 010 1.414L8.164 12l7.793 7.793a1 1 0 11-1.414 1.414L5.336 12l9.207-9.207a1 1 0 011.414 0z">
                    </path>
                </svg>
            </button>

            <button>
                <svg role="img" height="24" width="24" class="Svg-sc-1bi12j5-0 jgfuCe IYDlXmBmmUKHveMzIPCF"
                    viewBox="0 0 24 24">
                    <path
                        d="M8.043 2.793a1 1 0 000 1.414L15.836 12l-7.793 7.793a1 1 0 101.414 1.414L18.664 12 9.457 2.793a1 1 0 00-1.414 0z">
                    </path>
                </svg>
            </button>
        </div>
        <div class="artistName">
            <a>
                Adele
            </a>
        </div>
        <div class="discography">
        </div>

        <div class="fakeNav">
            <div style="height: 100%; width: 100%;">
                <img style="min-height: 100%;" src="./images/falsenav.png">
            </div>
        </div>
        <div class="player">
            <div class="currentSongInfo">
                <div class="albumsContainer">
                    <div class="albumThumb">
                        <img src="./images/30.jpg">
                    </div>
                    <div class="artistInfo">
                        <span>Stranger By Nature</span>
                        <span>Adele</span>
                    </div>
                    
                </div>
            </div>
            <div class="playerButtons">
                <button class="play">
                    <svg role="img" height="16" width="16" viewBox="0 0 16 16" class="playerPlayButton">
                        <path
                            d="M3 1.713a.7.7 0 011.05-.607l10.89 6.288a.7.7 0 010 1.212L4.05 14.894A.7.7 0 013 14.288V1.713z">
                        </path>
                    </svg>
                    <svg role="img" height="16" width="16" viewBox="0 0 16 16" class="playerPauseButton">
                        <path
                            d="M2.7 1a.7.7 0 00-.7.7v12.6a.7.7 0 00.7.7h2.6a.7.7 0 00.7-.7V1.7a.7.7 0 00-.7-.7H2.7zm8 0a.7.7 0 00-.7.7v12.6a.7.7 0 00.7.7h2.6a.7.7 0 00.7-.7V1.7a.7.7 0 00-.7-.7h-2.6z">
                        </path>
                    </svg>
                </button>
                <div class="songProgress">
                    <div class="currentTime">
                        0:00
                    </div>
                    <div>
                        <div class="progressBar">
                            <div class="progressBarFilled"></div>
                        </div>
                    </div>
                    <div class="totalTime">
                        0:00
                    </div>
                </div>
            </div>
            <div style="width: 25%"></div>
        </div>
    </div>
    <script>

        let albumsContainer = document.querySelector(`.discography`);
        const song = document.querySelector(`.song`);
        const progressBar = document.querySelector('.progressBar')
        const playerPlayButton = document.querySelector('.play .playerPlayButton')
        const playerPauseButton = document.querySelector('.play .playerPauseButton')


        function createAlbumNameDiv(discography) {

            const F = discography.map((album, index) => {

                return ` 
                <div class="backgrounds">
                    ${index != 0 ? '<div class="separator"></div>' : ''}
                    <div class="albumsContainer">
                        <div class="albumPics">
                            <img src="./images/${album.name}.jpg">
                        </div>
                        <div class="albumInfo">
                            <div class='albumName'>
                                <span>${album.name}</span>
                            </div>
                            <div class="albumRealaseDate">
                                <span>Álbum</span>
                                <span>• ${album.year} •</span>
                                <span>${album.numberOfSongs} canciones</span>
                            </div>
                            <div class="buttons">
                                <button id ="${album.name}">
                                    <svg role="img" height="16" width="16" viewBox="0 0 16 16" class="Svg-sc-1bi12j5-0 jgfuCe">
                                        <path
                                            d="M3 1.713a.7.7 0 011.05-.607l10.89 6.288a.7.7 0 010 1.212L4.05 14.894A.7.7 0 013 14.288V1.713z">
                                        </path>
                                    </svg>
                                </button>
                                <button type="submit">
                                    <svg role="img" height="24" width="24" viewBox="0 0 24 24" class="Svg-sc-1bi12j5-0 jgfuCe">
                                        <path
                                            d="M5.21 1.57a6.757 6.757 0 016.708 1.545.124.124 0 00.165 0 6.741 6.741 0 015.715-1.78l.004.001a6.802 6.802 0 015.571 5.376v.003a6.689 6.689 0 01-1.49 5.655l-7.954 9.48a2.518 2.518 0 01-3.857 0L2.12 12.37A6.683 6.683 0 01.627 6.714 6.757 6.757 0 015.21 1.57zm3.12 1.803a4.757 4.757 0 00-5.74 3.725l-.001.002a4.684 4.684 0 001.049 3.969l.009.01 7.958 9.485a.518.518 0 00.79 0l7.968-9.495a4.688 4.688 0 001.049-3.965 4.803 4.803 0 00-3.931-3.794 4.74 4.74 0 00-4.023 1.256l-.008.008a2.123 2.123 0 01-2.9 0l-.007-.007a4.757 4.757 0 00-2.214-1.194z">
                                        </path>
                                    </svg>
                                </button>
                                <button type="submit">
                                    <svg role="img" height="24" width="24" viewBox="0 0 24 24" class="Svg-sc-1bi12j5-0 jgfuCe">
                                        <path
                                            d="M4.5 13.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm15 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm-7.5 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        </div>
                        <div class="listHeader">
                            <span>#</span>
                            <span>TÍTULO</span>
                            <span>
                                <svg role="img" height="16" width="16" viewBox="0 0 16 16" class="Svg-sc-1bi12j5-0 jgfuCe">
                                    <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z"></path>
                                    <path d="M8 3.25a.75.75 0 01.75.75v3.25H11a.75.75 0 010 1.5H7.25V4A.75.75 0 018 3.25z"></path>
                                </svg>
                            </span>
                        </div>
                        ${createSongsListDiv(album, album.songs)}
                    </div>
    `
            })
            return F.join(``);
        }

        function createSongsListDiv(album, songs) {


            return songs.map((song, index) => {

                return `
                    <div class="songsListContainer ${[index + 1] == 1 ? 'firstContainer' : ''}" id="${index == 0 ? album.name : ''}">
                        <span class="songNumber">${[index + 1]}</span>
                        <span class='playIcon'>
                            <svg role="img" height="16" width="16" viewBox="0 0 24 24">
                                <path d="M7.05 3.606l13.49 7.788a.7.7 0 010 1.212L7.05 20.394A.7.7 0 016 19.788V4.212a.7.7 0 011.05-.606z">
                                </path>
                            </svg>
                        </span>
                        <div class="songName" >
                            <span>${song.name}</span>
                            <span>Adele</span>
                        </div>
                        <div class ="duration">
                            <span>${song.duration}</span>
                        </div>
                    </div>                    
                    `
            }).join('')
        }

        function playOrPause() {
            if (song.paused) {
                song.play()
                this.classList.add('playing')
                playerPauseButton.classList.remove('playerPauseButton')
                playerPauseButton.classList.add('playerPlayButton')
                playerPlayButton.classList.remove('playerPlayButton')

            }
            else {
                song.pause()
                this.classList.remove('playing')
                playerPlayButton.classList.add('playerPlayButton')
                playerPauseButton.classList.add('playerPauseButton')
            }
        }

        function playFirstSong() {

            const albumId = this.id
            const container = document.querySelectorAll(`.firstContainer`)
            let firstSongSelector;

            for (let i = 0; i < container.length; i++) {
                if (container[i].id == albumId) {
                    firstSongSelector = container[i]
                }
            }
            if (song.paused) {
                song.play()
                playerPauseButton.classList.remove('playerPauseButton')
                playerPauseButton.classList.add('playerPlayButton')
                playerPlayButton.classList.remove('playerPlayButton')
                firstSongSelector.classList.add('playing')
            }
            else {
                song.pause()
                playerPlayButton.classList.add('playerPlayButton')
                playerPauseButton.classList.add('playerPauseButton')
                firstSongSelector.classList.remove('playing')
            }
        }

        function handleProgress() {
            const percent = (song.currentTime / song.duration) * 100

            const currentTime = document.querySelector('.currentTime')
            const totalTime = document.querySelector('.totalTime')
            const progressBarFilled = document.querySelector('.progressBarFilled')

            const currentSeconds = parseInt(song.currentTime % 60);
            const currentMinutes = parseInt((song.currentTime / 60) % 60);

            
            const totalSeconds = parseInt(song.duration % 60);
            const totalMinutes = parseInt((song.duration / 60) % 60);

            currentTime.innerHTML = `${currentMinutes}:${currentSeconds}`
            totalTime.innerHTML = `${totalMinutes}:${totalSeconds}`
            progressBarFilled.style.width = `${percent}%`


        }

        function manualProgress(e){
            const percent = (e.offsetX / progressBar.offsetWidth) * 100
            song.currentTime = (song.duration * percent) / 100
        }

        window.addEventListener('load', async () => {

            const endpoint = "https://gist.githubusercontent.com/flportilla/0b4acce06e2aed6ad39de765fe06ab2c/raw/c8ffc86dd67620704606770b4ec83ad6c76feab5/Adele.json"

            const discography =
                await fetch(endpoint)
                    .then(blob => blob.json());

            albumsContainer.innerHTML = createAlbumNameDiv(discography);
            const songsContainer = document.querySelectorAll('.songsListContainer')
            const albumPlayButton = document.querySelectorAll('.buttons > button:first-child')
            const playerButtons = document.querySelectorAll('.play')

            songsContainer.forEach(song => {
                song.addEventListener('click', playOrPause)
            })

            albumPlayButton.forEach(button => {
                button.addEventListener('click', playFirstSong)
            })

            song.addEventListener('timeupdate', handleProgress)

            progressBar.addEventListener('click', manualProgress)

            playerButtons.forEach(button => {
                button.addEventListener('click', playOrPause)
            })
            
        })


    </script>

</body>